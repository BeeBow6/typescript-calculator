!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";var i;s.r(e),function(t){t.ADD="+",t.SUBTRACT="-",t.MULTIPLY="*",t.DIVIDE="/",t.LEFT_PAREN="(",t.RIGHT_PAREN=")"}(i||(i={}));const r=i.SUBTRACT;var n,a;!function(t){t.ZERO="0",t.ONE="1",t.TWO="2",t.THREE="3",t.FOUR="4",t.FIVE="5",t.SIX="6",t.SEVEN="7",t.EIGHT="8",t.NINE="9",t.POINT="."}(n||(n={})),function(t){t.NUMBER="10",t.PI="11",t.OPERATOR="20",t.LEFT_PAREN="21",t.RIGHT_PAREN="22",t.INVERSION="23",t.EQUAL="80",t.CLEAR="90",t.ALL_CLEAR="91",t.BACKSPACE="92"}(a||(a={}));const c=[{text:n.ZERO,value:n.ZERO,type:a.NUMBER,order:21,keyCodeList:["48","96"]},{text:n.ONE,value:n.ONE,type:a.NUMBER,order:17,keyCodeList:["49","97"]},{text:n.TWO,value:n.TWO,type:a.NUMBER,order:18,keyCodeList:["50","98"]},{text:n.THREE,value:n.THREE,type:a.NUMBER,order:19,keyCodeList:["51","99"]},{text:n.FOUR,value:n.FOUR,type:a.NUMBER,order:13,keyCodeList:["52","100"]},{text:n.FIVE,value:n.FIVE,type:a.NUMBER,order:14,keyCodeList:["53","101"]},{text:n.SIX,value:n.SIX,type:a.NUMBER,order:15,keyCodeList:["54","102"]},{text:n.SEVEN,value:n.SEVEN,type:a.NUMBER,order:9,keyCodeList:["55","103"]},{text:n.EIGHT,value:n.EIGHT,type:a.NUMBER,order:10,keyCodeList:["56","104"]},{text:n.NINE,value:n.NINE,type:a.NUMBER,order:11,keyCodeList:["57","105"]},{text:n.POINT,value:n.POINT,type:a.NUMBER,order:22,keyCodeList:["110","190"]},{text:"π",type:a.PI,order:1,keyCodeList:["80"]},{text:"＋",value:i.ADD,type:a.OPERATOR,order:20,keyCodeList:["107","shift187"]},{text:"－",value:i.SUBTRACT,type:a.OPERATOR,order:16,keyCodeList:["109","189"]},{text:"×",value:i.MULTIPLY,type:a.OPERATOR,order:12,keyCodeList:["106","shift186"]},{text:"÷",value:i.DIVIDE,type:a.OPERATOR,order:8,keyCodeList:["111","191"]},{text:"(",value:i.LEFT_PAREN,type:a.LEFT_PAREN,order:5,keyCodeList:["shift56"]},{text:")",value:i.RIGHT_PAREN,type:a.RIGHT_PAREN,order:6,keyCodeList:["shift57"]},{text:"+/-",type:a.INVERSION,order:7,keyCodeList:["73"]},{text:"＝",type:a.EQUAL,order:23,keyCodeList:["13"],size:2},{text:"←",type:a.BACKSPACE,order:2,keyCodeList:["8"]},{text:"C",type:a.CLEAR,order:3,keyCodeList:["46"]},{text:"AC",type:a.ALL_CLEAR,order:4,keyCodeList:["27"]}],l=t=>{const e=(t+"").split(".")[1];return e?e.length:0},u=(t,e,s)=>{const i=Math.max(l(t),l(e)),r=Math.pow(10,i);return s(o(t,r),o(e,r),r)},o=(t,e)=>{const s=+`${t}`.replace(".",""),i=+`${e}`.replace(".",""),r=l(t)+l(e);return s*i/Math.pow(10,r)},h=t=>t===i.ADD||t===i.SUBTRACT?1:t===i.MULTIPLY||t===i.DIVIDE?2:void 0,p=t=>{let e=[],s=[];return t.forEach(t=>{if("number"!=typeof t)if(t!==i.LEFT_PAREN)if(t!==i.RIGHT_PAREN){if(s.length){((t,e)=>h(t)-h(e))(s.slice(-1)[0],t)>0&&e.push(s.pop())}s.push(t)}else for(;s.length;){const t=s.pop();if(t===i.LEFT_PAREN)break;e.push(t)}else s.push(t);else Number.isFinite(t)&&e.push(t)}),e.push(...s.reverse()),e};var d=t=>{if(!t.length)return 0;const e=p(t);let s=[];e.forEach(t=>{if("number"==typeof t)return void s.push(t);const e=s.pop(),r=s.pop();if("number"==typeof e&&"number"==typeof r)switch(t){case i.ADD:return s.push(((t,e)=>u(t,e,(t,e,s)=>(t+e)/s))(r,e));case i.SUBTRACT:return s.push(((t,e)=>u(t,e,(t,e,s)=>(t-e)/s))(r,e));case i.MULTIPLY:return s.push(o(r,e));case i.DIVIDE:return s.push(((t,e)=>{if(0===e)throw new Error("0で割れません");return u(t,e,(t,e)=>t/e)})(r,e))}});const r=s[0];return"number"==typeof r?r:0};class y{constructor(){}static get instance(){return this._instance||(this._instance=new y),this._instance}inputNumber(t,e){t.clearHistory(),t.toggleAnswerMode(!1),t.displayNumber(e),t.switchState(N.instance)}inputPi(t,e){this.inputNumber(t,e)}inputOperator(t,e){t.clearHistory(),t.toggleAnswerMode(!1),t.determineNumber(),t.setOperator(e),t.switchState(E.instance)}inputLeftParen(t){t.clearAll(),t.toggleAnswerMode(!1),t.setLeftParen(),t.switchState(b.instance)}inputRightParen(){}inputInversion(t){t.clearHistory(),t.toggleAnswerMode(!1),t.invertSign(),t.switchState(N.instance)}inputEqual(){}inputBack(t){t.clearHistory(),t.toggleAnswerMode(!1),t.backSpaceDisplay()?t.switchState(b.instance):t.switchState(N.instance)}inputClear(t){this.inputAllClear(t)}inputAllClear(t){t.clearAll(),t.toggleAnswerMode(!1),t.switchState(b.instance)}}class E{constructor(){}static get instance(){return this._instance||(this._instance=new E),this._instance}inputNumber(t,e){t.displayNumber(e),t.switchState(N.instance)}inputPi(t,e){this.inputNumber(t,e)}inputOperator(t,e){t.setOperator(e)}inputLeftParen(t){t.setLeftParen(),t.switchState(b.instance)}inputRightParen(){}inputInversion(t){t.clearDisplay(),t.invertSign(),t.switchState(N.instance)}inputEqual(t){try{t.setOperator(),t.executeCalculation(),t.toggleAnswerMode(!0),t.switchState(y.instance)}catch(e){t.setError(e)}}inputBack(){}inputClear(t){t.clearDisplay()}inputAllClear(t){t.clearAll(),t.switchState(b.instance)}}class m{constructor(){}static get instance(){return this._instance||(this._instance=new m),this._instance}inputNumber(t,e){t.setOperator(i.MULTIPLY),t.displayNumber(e),t.switchState(N.instance)}inputPi(t,e){this.inputNumber(t,e)}inputOperator(t,e){t.setOperator(e),t.switchState(E.instance)}inputLeftParen(t){t.setOperator(i.MULTIPLY),t.setLeftParen(),t.switchState(b.instance)}inputRightParen(t){t.setRightParen()}inputInversion(t){t.setOperator(i.MULTIPLY),t.invertSign(),t.switchState(N.instance)}inputEqual(t){try{t.executeCalculation(),t.toggleAnswerMode(!0),t.switchState(y.instance)}catch(e){t.setError(e)}}inputBack(){}inputClear(){}inputAllClear(t){t.clearAll(),t.switchState(b.instance)}}class N{constructor(){}static get instance(){return this._instance||(this._instance=new N),this._instance}inputNumber(t,e){t.addDisplayNumber(e)}inputPi(t,e){t.displayNumber(e)}inputOperator(t,e){try{t.determineNumber(),t.executeCalculation(),t.setOperator(e),t.switchState(E.instance)}catch(e){t.setError(e)}}inputLeftParen(t){t.determineNumber(),t.setOperator(i.MULTIPLY),t.setLeftParen(),t.switchState(b.instance)}inputRightParen(t){if(t.checkParenMode())try{t.determineNumber(),t.setRightParen(),t.executeCalculation(),t.switchState(m.instance)}catch(e){t.setError(e)}}inputInversion(t){t.invertSign()}inputBack(t){t.backSpaceDisplay()&&t.switchState(b.instance)}inputEqual(t){try{t.determineNumber(),t.executeCalculation(),t.toggleAnswerMode(!0),t.switchState(y.instance)}catch(e){t.setError(e)}}inputClear(t){t.clearDisplay(),t.switchState(b.instance)}inputAllClear(t){t.clearAll(),t.switchState(b.instance)}}class b{constructor(){}static get instance(){return this._instance||(this._instance=new b),this._instance}inputNumber(t,e){t.displayNumber(e),t.switchState(N.instance)}inputPi(t,e){this.inputNumber(t,e)}inputOperator(t,e){t.displayNumber(n.ZERO),t.determineNumber(),t.setOperator(e),t.switchState(E.instance)}inputLeftParen(t){t.setLeftParen()}inputInversion(t){t.invertSign(),t.switchState(N.instance)}inputRightParen(){}inputEqual(){}inputBack(){}inputClear(){}inputAllClear(t){t.clearAll()}}class g{constructor(){}static get instance(){return this._instance||(this._instance=new g),this._instance}inputNumber(){}inputPi(){}inputOperator(){}inputLeftParen(){}inputRightParen(){}inputInversion(){}inputEqual(){}inputBack(){}inputClear(){}inputAllClear(t){t.clearAll(),t.switchState(b.instance)}}class P{constructor(t={}){const e=document.createElement("div");e.innerHTML=this.replaceTemplate(this.getTemplate(),t),this._element=e.firstElementChild}replaceTemplate(t,e={}){return t.replace(/\{\{(.+?)\}\}/g,(t,s)=>e[s]||"")}get element(){return this._element}}var R=function(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(s[i[r]]=t[i[r]])}return s};class L extends P{constructor(t){var{text:e,order:s,size:i}=t,r=R(t,["text","order","size"]);super({text:e,order:s}),this.element.style.gridColumnEnd=i?"span "+i:"",r.type===a.NUMBER&&this.element.classList.add("btn-num"),this.type=r.type,this.value=r.value,this.keyCodeList=r.keyCodeList,this.onClick=r.onClick,this.element.addEventListener("click",this.handleClick.bind(this)),document.addEventListener("keydown",this.handleKeydown.bind(this)),document.addEventListener("keyup",this.handleKeyup.bind(this))}getTemplate(){return'<button type="button" class="btn" style="order:{{order}}">\n      {{text}}\n    </button>'}handleClick(){this.onClick(this.type,this.value)}handleKeydown(t){this.element.classList.toggle("btn-active",this.checkKeyCode(t))}handleKeyup(t){this.element.classList.remove("btn-active"),this.checkKeyCode(t)&&this.handleClick()}checkKeyCode(t){const e=t.shiftKey?"shift":"";return this.keyCodeList.includes(e+t.keyCode)}}class f extends P{getTemplate(){return'<form class="panel"></form>'}add(t){this.element.appendChild(t.element)}toggleAnswerMode(t){this.element.classList.toggle("is-answer",t)}}class C extends P{constructor(){super(),this.stack=[],this.currentOperator=null,this.countParen=0,this.clear()}getTemplate(){return'<input value="" type="text" class="lbl lbl-small" readonly>'}get isParenMode(){return this.countParen>0}setNumber(t){this.setStack(t)}setOperator(t=null){this.currentOperator=t,this.display()}setLeftParen(){this.countParen++,this.setStack(i.LEFT_PAREN)}setRightParen(){this.countParen&&(this.countParen--,this.stack.push(i.RIGHT_PAREN),this.currentOperator=null,this.display())}getStack(){const t=Array(this.countParen).fill(i.RIGHT_PAREN);return[...this.stack,...t]}setResult(){this.stack=this.getStack(),this.display()}clear(){this.currentOperator=null,this.countParen=0,this.stack=[],this.display()}setStack(t){this.currentOperator&&(this.stack.push(this.currentOperator),this.currentOperator=null),this.stack.length&&t<0?this.stack.push(i.LEFT_PAREN,t,i.RIGHT_PAREN):this.stack.push(t),this.display()}display(){this.element.value=[...this.stack,this.currentOperator].join("")}}const k=12;class O extends P{constructor(){super(),this.data="",this.isDecimal=!1,this.isNegative=!1,this.clear()}get isEmpty(){return""===this.data}getTemplate(){return'<input value="" type="text" class="lbl lbl-large" readonly>'}addNumber(t){if(!(this.data.length>=k)){if(t===n.POINT){if(this.isDecimal)return;this.data||(this.data=n.ZERO),this.isDecimal=!0}else this.data===n.ZERO&&(this.data="");this.data+=t,this.displayNumber()}}setNumber(t){this.reset(),"number"==typeof t?(this.isNegative=t<0,this.data=`${Math.abs(t)||""}`.slice(0,k),this.isDecimal=this.data.includes(n.POINT),this.displayNumber()):this.addNumber(t)}invertSign(){this.isNegative=!this.isNegative,this.displayNumber()}getNumber(){return Number.parseFloat(this.element.value)||0}removeLastNumber(){this.data=this.data.slice(0,-1),this.isDecimal&&(this.isDecimal=this.data.includes(n.POINT)),""===this.data&&(this.isNegative=!1),this.displayNumber()}clear(){this.toggleErrorMode(!1),this.reset(),this.displayNumber()}setError(t){this.toggleErrorMode(!0),this.element.value=t}displayNumber(){const t=(this.isNegative?r:"")+this.data;this.element.value=t||n.ZERO}reset(){this.data="",this.isDecimal=this.isNegative=!1}toggleErrorMode(t=!1){this.element.classList.toggle("is-error",t)}}const A=t=>Object.values(n).includes(t);class v{constructor(t){this.panel=new f,this.process=new C,this.display=new O,this.panel.add(this.process),this.panel.add(this.display),this.handleClick=this.handleClick.bind(this),c.forEach(t=>{this.panel.add(new L(Object.assign({},t,{onClick:this.handleClick})))}),t.appendChild(this.panel.element),this.switchState(b.instance)}handleClick(t,e){switch(t){case a.NUMBER:if(A(e)){this.state.inputNumber(this,e);break}case a.PI:this.state.inputPi(this,Math.PI);break;case a.OPERATOR:if(!A(e)){this.state.inputOperator(this,e);break}case a.LEFT_PAREN:this.state.inputLeftParen(this);break;case a.RIGHT_PAREN:this.state.inputRightParen(this);break;case a.INVERSION:this.state.inputInversion(this);break;case a.EQUAL:this.state.inputEqual(this);break;case a.BACKSPACE:this.state.inputBack(this);break;case a.CLEAR:this.state.inputClear(this);break;case a.ALL_CLEAR:this.state.inputAllClear(this);break;default:throw new Error("Unknown input value.")}}switchState(t){this.state=t}displayNumber(t){this.display.setNumber(t)}addDisplayNumber(t){this.display.addNumber(t)}setOperator(t){this.process.setOperator(t)}determineNumber(){const t=this.display.getNumber();this.process.setNumber(t)}checkParenMode(){return this.process.isParenMode}setLeftParen(){this.process.setLeftParen()}setRightParen(){this.process.setRightParen()}invertSign(){this.display.invertSign()}executeCalculation(){const t=d(this.process.getStack());this.display.setNumber(t)}backSpaceDisplay(){return this.display.removeLastNumber(),this.display.isEmpty}clearDisplay(){this.display.clear()}clearHistory(){this.process.clear()}clearAll(){this.process.clear(),this.display.clear()}setError(t){this.display.setError(t.message),this.switchState(g.instance)}toggleAnswerMode(t=!1){this.panel.toggleAnswerMode(t),t&&this.process.setResult()}}let S={};(t=>{const e=document.querySelector(t);!!e&&(t in S||(S[t]=new v(e)))})("#root")}]);